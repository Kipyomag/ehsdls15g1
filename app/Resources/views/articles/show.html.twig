{% extends 'base.html.twig' %}

{% block title %}Article{% endblock %}

{% block body %}

<div class="col-xs-12">
        <a class="btn btn-default" href="{{ path('articles_index') }}">Retour vers la liste</a>
        
        {% if is_granted('ROLE_MODERATEUR') %}
            <a class="btn btn-default" href="{{ path('articles_edit', { 'id': article.id }) }}">Editer</a>
                {{ form_start(delete_form) }}
                    <input type="submit" value="Supprimer">
                {{ form_end(delete_form) }}
                {% if article.status == 'submit' %}
                    {{ form_start(refused_form) }}
                        <input type="submit" value="Ne pas publier">
                    {{ form_end(refused_form) }}
                    {{ form_start(publish_form) }}
                        <input type="submit" value="Publier">
                    {{ form_end(publish_form) }}
                {% elseif article.status == 'progress' %}
                    {{ form_start(publish_form) }}
                        <input type="submit" value="Publier">
                    {{ form_end(publish_form) }}
                {% else %}
                    {{ form_start(refused_form) }}
                        <input type="submit" value="Ne plus publier">
                    {{ form_end(refused_form) }}
                {% endif %}
        {% endif %}

    {% if article.status == 'refused' %}
        <p class="refusedArticle">Article refusé</p>
    {% endif %}

    {% if article.status == 'progress' %}
        <p class="progressArticle">Article en cours de rédaction</p>
    {% endif %}

    {% if article.status == 'submit' %}
        <p class="submitArticle">Article refusé</p>
    {% endif %}

    <h1>{{ article.titre }}</h1>
    <div>
        <table class="table">
            <tbody>
                <tr>
                    <td>{{ article.chapeau }}</td>
                </tr>
                <tr>
                    <td>{{ article.contenu | raw }}</td>
                </tr>
                <tr>
                    <td>{{ article.date|date("d/m/Y") }}</td>
                </tr>
                <tr>
                    <td>by {{ article.author.nom }} {{ article.author.prenom }}</td>
                </tr>
            </tbody>
        </table>

        {% if article.status == 'published' %}
        <h1>Commentaires</h1>
        <div id="toggle">
        {{ form_start(comment_form) }}
            {{ form_widget(comment_form) }}
            <input type="submit" value="Envoyer" />
        {{ form_end(comment_form) }}
        </div>
        <table class="table">
        {% for comment in article.comments %}
                <tr>
                    <td>{{ comment.author.nom }} {{ comment.author.prenom }}</td>

                    <td>{{ comment.content | raw }}</td>
                    <th>{{ comment.creationDate|date("d/m/Y") }}</th>


                    {% if is_granted('ROLE_MODERATEUR') %}
                        <td><a href="{{ path('comment_delete', { 'id': comment.id }) }}">X</a></td>
                    {% endif %}

                </tr>
        {% endfor %}
        </table>
        {% endif %}
        

    </div>
</div>
{% endblock %}
